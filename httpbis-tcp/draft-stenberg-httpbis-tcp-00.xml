<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version  -->

<!DOCTYPE rfc SYSTEM "../Tools/rfc2629xslt/rfc2629.dtd" [
]>

<?rfc toc="yes"?>
<?rfc tocindent="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc strict="yes"?>
<?rfc compact="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>

<rfc ipr="trust200902" docName="draft-stenberg-httpbis-tcp-00" category="bcp">

  <front>
    <title abbrev="TCP for HTTP">TCP Performance Tuning for HTTP</title>

    <author initials="D." surname="Stenberg" fullname="Daniel Stenberg">
      <organization>Mozilla</organization>
      <address>
        <email>daniel@haxx.se</email>
        <uri>http://daniel.haxx.se</uri>
      </address>
    </author>

    <date year="2015"/>

    <area>General</area>
    <workgroup>httpbis</workgroup>
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>This document records current best practice for using all versions of HTTP over TCP.</t>



    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>HTTP version 1.1 <xref target="RFC7230"/> as well as HTTP version 2 <xref target="RFC7540"/> are defined
to use TCP <xref target="RFC0793"/>, and their performance can depend greatly upon how TCP
is configured. This document records best current practice for using HTTP over
TCP, with a focus on improving end-user perceived performance.</t>

<t>These practices are generally applicable to HTTP/1 as well as HTTP/2, although
some may note particular impact or nuance regarding a particular protocol
version.</t>

<section anchor="notational-conventions" title="Notational Conventions">

<t>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”,
“SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be
interpreted as described in <xref target="RFC2119"/>.</t>

</section>
</section>
<section anchor="tcp-fast-open" title="TCP Fast Open">

<t>TCP Fast Open (a.k.a. TFO, <xref target="RFC7430"/>) allows data to be sent on the TCP
handshake, thereby allowing a request to be sent without any delay if a
connection is not open.</t>

<t>TFO requires both client and server support, and additionally requires
application knowledge, because the data sent on the SYN cannot be
non-idempotent. Therefore, TFO can only be used on idempotent, safe methods
(e.g., GET and HEAD), or with intervening negotiation (e.g, using TLS).</t>

<t>Support for TFO is growing in client platforms, especially mobile, due to the
significant performance advantage it gives.</t>

</section>
<section anchor="initial-congestion-window" title="Initial Congestion Window">

<t><xref target="RFC6928"/> specifies an initial congestion window of 10, and is now fairly
widely deployed server-side. There has been experimentation with larger
initial windows, in combination with packet pacing.</t>

</section>
<section anchor="packet-pacing" title="Packet Pacing">

<t>TBD</t>

</section>
<section anchor="explicit-congestion-control" title="Explicit Congestion Control">

<t>Apple <eref target="https://developer.apple.com/videos/wwdc/2015/?id=719">deploying in iOS and OSX</eref>.</t>

</section>
<section anchor="tail-loss-probes" title="Tail Loss Probes">

<t><eref target="http://tools.ietf.org/html/draft-dukkipati-tcpm-tcp-loss-probe-01">draft</eref></t>

</section>
<section anchor="slow-start-after-idle" title="Slow Start after Idle">

<t>Slow-start is one of the algorithms that TCP uses to control congestion inside
the network. It is also known as the exponential growth phase. Each TCP
connection will start off in slow-start but will also go back to slow-start
after a certain amount of idle time.</t>

<t>In Linux systems you can prevent the TCP stack from going back to slow-start
after idle by settting</t>

<figure><artwork><![CDATA[
net.ipv4.tcp_slow_start_after_idle = 0
]]></artwork></figure>

</section>
<section anchor="nagles-algorithm" title="Nagle’s Algorithm">

<t>Nagle’s Algorithm <xref target="RFC0896"/> is the mechanism that makes the TCP stack hold
(small) outgoing packets for a short period of time so that it can
potentionally merge that packet with the next outgoing one. It is optmized for
throughput at the expence of latency.</t>

<t>HTTP/2 in particular requires that the client can send a packet back fast even
during transfers that are perceived as single direction transfers. Even small
delays in those sends can cause a significant performance loss.</t>

<t>HTTP/1.1 is also affected, especially when sending off a full request in a
single write() system call.</t>

<t>In POSIX systems you switch it off like this:</t>

<figure><artwork><![CDATA[
int one = 1;
setsockopt(fd, IPPROTO_TCP, TCP_NODELAY, &one, sizeof(one));
]]></artwork></figure>

</section>
<section anchor="half-close" title="Half-close">

<t>Client or server is free to half-close after a request or response has been
completed; or when there is no pending stream in HTTP/2.</t>

<t>Half-closing is sometimes the only way for a server to make sure it closes
down connections cleanly so that it doesn’t accept more requests while still
allowing clients to receive the ongoing responses.</t>

</section>
<section anchor="abort" title="Abort">

<t>No client abort for HTTP/1.1 after the request body has been sent. Delayed
full close is expected following an error response to avoid RST on the client.</t>

</section>
<section anchor="keep-alive" title="Keep-alive">

<t>TCP keep-alive is likely disabled - at least on mobile clients for energy
saving purposes. App-level keep-alive is then required for long-lived requests
to detect failed peers or connections reset by stateful firewalls etc.</t>

</section>
<section anchor="tcp-bound-authentications" title="TCP-Bound Authentications">

<t>TBD</t>

</section>
<section anchor="closing-idle-connections" title="Closing Idle Connections">

<t>TBD</t>

</section>
<section anchor="iana-considerations" title="IANA Considerations">

<t>This document does not require action from IANA.</t>

</section>
<section anchor="security-considerations" title="Security Considerations">

</section>


  </middle>

  <back>

    <references title='Normative References'>





<reference  anchor='RFC2119' target='http://www.rfc-editor.org/info/rfc2119'>
<front>
<title>Key words for use in RFCs to Indicate Requirement Levels</title>
<author initials='S.' surname='Bradner' fullname='S. Bradner'><organization /></author>
<date year='1997' month='March' />
<abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='2119'/>
<seriesInfo name='DOI' value='10.17487/RFC2119'/>
</reference>



<reference  anchor='RFC7230' target='http://www.rfc-editor.org/info/rfc7230'>
<front>
<title>Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</title>
<author initials='R.' surname='Fielding' fullname='R. Fielding' role='editor'><organization /></author>
<author initials='J.' surname='Reschke' fullname='J. Reschke' role='editor'><organization /></author>
<date year='2014' month='June' />
<abstract><t>The Hypertext Transfer Protocol (HTTP) is a stateless application-level protocol for distributed, collaborative, hypertext information systems.  This document provides an overview of HTTP architecture and its associated terminology, defines the &quot;http&quot; and &quot;https&quot; Uniform Resource Identifier (URI) schemes, defines the HTTP/1.1 message syntax and parsing requirements, and describes related security concerns for implementations.</t></abstract>
</front>
<seriesInfo name='RFC' value='7230'/>
<seriesInfo name='DOI' value='10.17487/RFC7230'/>
</reference>



<reference  anchor='RFC0793' target='http://www.rfc-editor.org/info/rfc793'>
<front>
<title>Transmission Control Protocol</title>
<author initials='J.' surname='Postel' fullname='J. Postel'><organization /></author>
<date year='1981' month='September' />
</front>
<seriesInfo name='STD' value='7'/>
<seriesInfo name='RFC' value='793'/>
<seriesInfo name='DOI' value='10.17487/RFC0793'/>
</reference>



<reference  anchor='RFC7540' target='http://www.rfc-editor.org/info/rfc7540'>
<front>
<title>Hypertext Transfer Protocol Version 2 (HTTP/2)</title>
<author initials='M.' surname='Belshe' fullname='M. Belshe'><organization /></author>
<author initials='R.' surname='Peon' fullname='R. Peon'><organization /></author>
<author initials='M.' surname='Thomson' fullname='M. Thomson' role='editor'><organization /></author>
<date year='2015' month='May' />
<abstract><t>This specification describes an optimized expression of the semantics of the Hypertext Transfer Protocol (HTTP), referred to as HTTP version 2 (HTTP/2).  HTTP/2 enables a more efficient use of network resources and a reduced perception of latency by introducing header field compression and allowing multiple concurrent exchanges on the same connection.  It also introduces unsolicited push of representations from servers to clients.</t><t>This specification is an alternative to, but does not obsolete, the HTTP/1.1 message syntax.  HTTP's existing semantics remain unchanged.</t></abstract>
</front>
<seriesInfo name='RFC' value='7540'/>
<seriesInfo name='DOI' value='10.17487/RFC7540'/>
</reference>




    </references>

    <references title='Informative References'>





<reference  anchor='RFC7430' target='http://www.rfc-editor.org/info/rfc7430'>
<front>
<title>Analysis of Residual Threats and Possible Fixes for Multipath TCP (MPTCP)</title>
<author initials='M.' surname='Bagnulo' fullname='M. Bagnulo'><organization /></author>
<author initials='C.' surname='Paasch' fullname='C. Paasch'><organization /></author>
<author initials='F.' surname='Gont' fullname='F. Gont'><organization /></author>
<author initials='O.' surname='Bonaventure' fullname='O. Bonaventure'><organization /></author>
<author initials='C.' surname='Raiciu' fullname='C. Raiciu'><organization /></author>
<date year='2015' month='July' />
<abstract><t>This document analyzes the residual threats for Multipath TCP (MPTCP) and explores possible solutions to address them.</t></abstract>
</front>
<seriesInfo name='RFC' value='7430'/>
<seriesInfo name='DOI' value='10.17487/RFC7430'/>
</reference>



<reference  anchor='RFC6928' target='http://www.rfc-editor.org/info/rfc6928'>
<front>
<title>Increasing TCP's Initial Window</title>
<author initials='J.' surname='Chu' fullname='J. Chu'><organization /></author>
<author initials='N.' surname='Dukkipati' fullname='N. Dukkipati'><organization /></author>
<author initials='Y.' surname='Cheng' fullname='Y. Cheng'><organization /></author>
<author initials='M.' surname='Mathis' fullname='M. Mathis'><organization /></author>
<date year='2013' month='April' />
<abstract><t>This document proposes an experiment to increase the permitted TCP initial window (IW) from between 2 and 4 segments, as specified in RFC 3390, to 10 segments with a fallback to the existing recommendation when performance issues are detected.  It discusses the motivation behind the increase, the advantages and disadvantages of the higher initial window, and presents results from several large-scale experiments showing that the higher initial window improves the overall performance of many web services without resulting in a congestion collapse.  The document closes with a discussion of usage and deployment for further experimental purposes recommended by the IETF TCP Maintenance and Minor Extensions (TCPM) working group.</t></abstract>
</front>
<seriesInfo name='RFC' value='6928'/>
<seriesInfo name='DOI' value='10.17487/RFC6928'/>
</reference>



<reference  anchor='RFC0896' target='http://www.rfc-editor.org/info/rfc896'>
<front>
<title>Congestion Control in IP/TCP Internetworks</title>
<author initials='J.' surname='Nagle' fullname='J. Nagle'><organization /></author>
<date year='1984' month='January' />
<abstract><t>This memo discusses some aspects of congestion control in IP/TCP    Internetworks.  It is intended to stimulate thought and further    discussion of this topic.  While some specific suggestions are made    for improved congestion control implementation, this memo does not    specify any standards.</t></abstract>
</front>
<seriesInfo name='RFC' value='896'/>
<seriesInfo name='DOI' value='10.17487/RFC0896'/>
</reference>




    </references>



  </back>
</rfc>

